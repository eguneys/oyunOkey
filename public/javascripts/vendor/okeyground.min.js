!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Okeyground=e()}}(function(){var e;return function(){function e(t,n,r){function a(o,u){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!u&&l)return l(o,!0);if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var s=n[o]={exports:{}};t[o][0].call(s.exports,function(e){var n=t[o][1][e];return a(n||e)},s,s.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}return e}()({1:[function(e,t,n){!function(e){function n(e,t){if("object"!==a(e))return t;for(var r in t)"object"===a(e[r])&&"object"===a(t[r])?e[r]=n(e[r],t[r]):e[r]=t[r];return e}function r(e,t,r){var o=r[0],u=r.length;(e||"object"!==a(o))&&(o={});for(var l=0;l<u;++l){var d=r[l],s=a(d);if("object"===s)for(var f in d)if("__proto__"!==f){var c=e?i.clone(d[f]):d[f];t?o[f]=n(o[f],c):o[f]=c}}return o}function a(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var i=function(e){return r(e===!0,!1,arguments)},o="merge";i.recursive=function(e){return r(e===!0,!0,arguments)},i.clone=function(e){var t,n,r=e,o=a(e);if("array"===o)for(r=[],n=e.length,t=0;t<n;++t)r[t]=i.clone(e[t]);else if("object"===o){r={};for(t in e)r[t]=i.clone(e[t])}return r},e?t.exports=i:window[o]=i}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],2:[function(t,n,r){!function(t,r){"use strict";var a=r(t);"undefined"==typeof window&&a.deps({document:"undefined"!=typeof document?document:{},location:"undefined"!=typeof location?location:{},clearTimeout:clearTimeout,setTimeout:setTimeout}),"object"==typeof n&&null!=n&&n.exports?n.exports=a:"function"==typeof e&&e.amd?e(function(){return a}):t.m=a}("undefined"!=typeof window?window:this,function a(e,t){"use strict";function n(e){return"function"==typeof e}function r(e){return"[object Object]"===Ke.call(e)}function i(e){return"[object String]"===Ke.call(e)}function o(){}function u(e){xe=e.document,Se=e.location,Me=e.cancelAnimationFrame||e.clearTimeout,Ee=e.requestAnimationFrame||e.setTimeout}function l(e,t){for(var n,r=[],a=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g;n=a.exec(t);)if(""===n[1]&&n[2])e.tag=n[2];else if("#"===n[1])e.attrs.id=n[2];else if("."===n[1])r.push(n[2]);else if("["===n[3].charAt(0)){var i=n[6];i&&(i=i.replace(/\\(["'])/g,"$1")),"class"===n[4]?r.push(i):e.attrs[n[4]]=i||!0}return r}function d(e,t){var n=t?e.slice(1):e;return 1===n.length&&Te(n[0])?n[0]:n}function s(e,t,n){var r="class"in t?"class":"className";for(var a in t)Ce.call(t,a)&&(a===r&&null!=t[a]&&""!==t[a]?(n.push(t[a]),e[a]=""):e[a]=t[a]);n.length&&(e[r]=n.join(" "))}function f(e,t){for(var a=[],o=1,u=arguments.length;o<u;o++)a[o-1]=arguments[o];if(e&&n(e.view))return ae(e,a);if(!i(e))throw new Error("selector in m(selector, attrs, children) should be a string");var f=null!=t&&r(t)&&!("tag"in t||"view"in t||"subtree"in t),c=f?t:{},p={tag:"div",attrs:{},children:d(a,f)};return s(p.attrs,c,l(p,e)),p}function c(e,t){for(var n=0;n<e.length&&!t(e[n],n++););}function p(e,t){c(e,function(e,n){return(e=e&&e.attrs)&&null!=e.key&&t(e,n)})}function v(e){try{if("boolean"!=typeof e&&null!=e&&null!=e.toString())return e}catch(t){}return""}function m(e,t,n,r){try{h(e,t,n),t.nodeValue=r}catch(a){}}function g(e){for(var t=0;t<e.length;t++)Te(e[t])&&(e=e.concat.apply([],e),t--);return e}function h(e,t,n){e.insertBefore(t,e.childNodes[n]||null)}function y(e,t,n,r){p(e,function(e,r){t[e=e.key]=t[e]?{action:je,index:r,from:t[e].index,element:n.nodes[t[e].index]||xe.createElement("div")}:{action:Be,index:r}});var a=[];for(var i in t)Ce.call(t,i)&&a.push(t[i]);var o=a.sort(q),u=new Array(n.length);return u.nodes=n.nodes.slice(),c(o,function(t){var a=t.index;if(t.action===Ae&&(V(n[a].nodes,n[a]),u.splice(a,1)),t.action===Be){var i=xe.createElement("div");i.key=e[a].attrs.key,h(r,i,a),u.splice(a,0,{attrs:{key:e[a].attrs.key},nodes:[i]}),u.nodes[a]=i}if(t.action===je){var o=t.element,l=r.childNodes[a];l!==o&&null!==o&&r.insertBefore(o,l||null),u[a]=n[t.from],u.nodes[a]=o}}),u}function w(e,t,n,r){var a=e.length!==t.length;return a||p(e,function(e,n){var r=t[n];return a=r&&r.attrs&&r.attrs.key!==e.key}),a?y(e,n,t,r):t}function b(e,t,n){c(e,function(e,r){null!=t[r]&&n.push.apply(n,t[r].nodes)}),c(t.nodes,function(e,r){null!=e.parentNode&&n.indexOf(e)<0&&V([e],[t[r]])}),e.length<t.length&&(t.length=e.length),t.nodes=n}function P(e){var t=0;p(e,function(){return c(e,function(e){(e=e&&e.attrs)&&null==e.key&&(e.key="__mithril__"+t++)}),1})}function k(e,t,n){return e.tag!==t.tag||(n.sort().join()!==Object.keys(t.attrs).sort().join()||(e.attrs.id!==t.attrs.id||(e.attrs.key!==t.attrs.key||("all"===f.redraw.strategy()?!t.configContext||t.configContext.retain!==!0:"diff"===f.redraw.strategy()&&(t.configContext&&t.configContext.retain===!1)))))}function O(e,t,r){k(e,t,r)&&(t.nodes.length&&V(t.nodes),t.configContext&&n(t.configContext.onunload)&&t.configContext.onunload(),t.controllers&&c(t.controllers,function(e){e.onunload&&e.onunload({preventDefault:o})}))}function x(e,t){return e.attrs.xmlns?e.attrs.xmlns:"svg"===e.tag?"http://www.w3.org/2000/svg":"math"===e.tag?"http://www.w3.org/1998/Math/MathML":t}function S(e,t,n){n.length&&(e.views=t,e.controllers=n,c(n,function(e){if(e.onunload&&e.onunload.$old&&(e.onunload=e.onunload.$old),Re&&e.onunload){var t=e.onunload;e.onunload=function(){},e.onunload.$old=t}}))}function E(e,t,r,a,i){if(n(t.attrs.config)){var o=i.configContext=i.configContext||{};e.push(function(){return t.attrs.config.call(t,r,!a,o,i)})}}function M(e,n,r,a,i,o,u,l){var d=e.nodes[0];return a&&J(d,n.tag,n.attrs,e.attrs,i),e.children=U(d,n.tag,t,t,n.children,e.children,!1,0,n.attrs.contenteditable?d:r,i,u),e.nodes.intact=!0,l.length&&(e.views=o,e.controllers=l),d}function C(e,t,n){var r;e.$trusted?r=ee(t,n,e):(r=[xe.createTextNode(e)],t.nodeName in De||h(t,r[0],n));var a;return a="string"==typeof e||"number"==typeof e||"boolean"==typeof e?new e.constructor(e):e,a.nodes=r,a}function K(e,t,n,r,a,i){var o=t.nodes;return r&&r===xe.activeElement&&e===t||(e.$trusted?(V(o,t),o=ee(n,a,e)):"textarea"===i?n.value=e:r?(r.innerHTML=e,o=[].slice.call(r.childNodes)):((1===o[0].nodeType||o.length>1||o[0].nodeValue.trim&&!o[0].nodeValue.trim())&&(V(t.nodes,t),o=[xe.createTextNode(e)]),m(n,o[0],a,e))),t=new e.constructor(e),t.nodes=o,t.$trusted=e.$trusted,t}function T(e,t,n,r,a,i,o){return e.nodes.length?e.valueOf()!==t.valueOf()||a?K(t,e,r,i,n,o):(e.nodes.intact=!0,e):C(t,r,n)}function D(e){return e.$trusted?e.nodes.length:Te(e)?e.length:1}function A(e,n,r,a,i,o,u,l,d){e=g(e);var s=[],f=n.length===e.length,c=0,v={},m=!1;p(n,function(e,t){m=!0,v[n[t].attrs.key]={action:Ae,index:t}}),P(e),m&&(n=w(e,n,v,r));for(var h=0,y=0,k=e.length;y<k;y++){var O=U(r,i,n,a,e[y],n[h],o,a+c||c,u,l,d);O!==t&&(f=f&&O.nodes.intact,c+=D(O),n[h++]=O)}return f||b(e,n,s),n}function B(e,t,n,r,a){if(null!=t){if(Ke.call(t)===Ke.call(e))return t;if(a&&a.nodes){var i=n-r,o=i+(Te(e)?e:t.nodes).length;V(a.nodes.slice(i,o),a.slice(i,o))}else t.nodes&&V(t.nodes,t)}return t=new e.constructor,t.tag&&(t={}),t.nodes=[],t}function j(e,t){return e.attrs.is?null==t?xe.createElement(e.tag,e.attrs.is):xe.createElementNS(t,e.tag,e.attrs.is):null==t?xe.createElement(e.tag):xe.createElementNS(t,e.tag)}function R(e,t,n,r){return r?J(t,e.tag,e.attrs,{},n):e.attrs}function G(e,n,r,a,i,o){return null!=e.children&&e.children.length>0?U(n,e.tag,t,t,e.children,r.children,!0,0,e.attrs.contenteditable?n:a,i,o):e.children}function L(e,t,n,r,a,i,o){var u={tag:e.tag,attrs:t,children:n,nodes:[r]};return S(u,i,o),u.children&&!u.children.nodes&&(u.children.nodes=[]),u}function F(e,t,r,a){var i;return i="diff"===f.redraw.strategy()&&e?e.indexOf(t):-1,i>-1?r[i]:n(a)?new a:{}}function N(e,t,n,r){null!=r.onunload&&Le.map(function(e){return e.handler}).indexOf(r.onunload)<0&&Le.push({controller:r,handler:r.onunload}),e.push(n),t.push(r)}function _(e,t,n,r,a,i){var o=F(n.views,t,r,e.controller),u=e&&e.attrs&&e.attrs.key;return e=0===Re||Fe||r&&r.indexOf(o)>-1?e.view(o):{tag:"placeholder"},"retain"===e.subtree?e:(e.attrs=e.attrs||{},e.attrs.key=u,N(i,a,t,o),e)}function I(e,t,n,r){for(var a=t&&t.controllers;null!=e.view;)e=_(e,e.view.$original||e.view,t,a,r,n);return e}function H(e,t,n,r,a,o,u,l){var d=[],s=[];if(e=I(e,t,d,s),"retain"===e.subtree)return t;if(!e.tag&&s.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");e.attrs=e.attrs||{},t.attrs=t.attrs||{};var f=Object.keys(e.attrs),c=f.length>("key"in e.attrs?1:0);if(O(e,t,f),i(e.tag)){var p=0===t.nodes.length;u=x(e,u);var v;if(p){v=j(e,u);var m=R(e,v,u,c);h(r,v,a);var g=G(e,v,t,n,u,l);t=L(e,m,g,v,u,d,s)}else v=M(t,e,n,c,u,d,l,s);return"select"===e.tag&&"value"in e.attrs&&J(v,e.tag,{value:e.attrs.value},{},u),p||o!==!0||null==v||h(r,v,a),E(l,e,v,p,t),t}}function U(e,t,a,i,o,u,l,d,s,f,c){return o=v(o),"retain"===o.subtree?u:(u=B(o,u,d,i,a),Te(o)?A(o,u,e,d,t,l,s,f,c):null!=o&&r(o)?H(o,u,s,e,d,l,f,c):n(o)?u:T(u,o,d,e,l,s,t))}function q(e,t){return e.action-t.action||e.index-t.index}function X(e,t,n){n===t&&(e.style="",n={});for(var r in t)Ce.call(t,r)&&(null!=n&&n[r]===t[r]||(e.style[r]=t[r]));for(r in n)Ce.call(n,r)&&(Ce.call(t,r)||(e.style[r]=""))}function z(e,t,a,i,o,u){if("config"===t||"key"===t)return!0;if(n(a)&&"on"===t.slice(0,2))e[t]=te(a,e);else if("style"===t&&null!=a&&r(a))X(e,a,i);else if(null!=u)"href"===t?e.setAttributeNS("http://www.w3.org/1999/xlink","href",a):e.setAttribute("className"===t?"class":t,a);else if(t in e&&!Ne[t])try{("input"!==o&&!e.isContentEditable||e[t]!=a)&&(e[t]=a)}catch(l){e.setAttribute(t,a)}else try{e.setAttribute(t,a)}catch(l){}}function $(e,t,n,r,a,i,o){if(t in a&&r===n&&"object"!=typeof n&&xe.activeElement!==e)"value"===t&&"input"===i&&e.value!=n&&(e.value=n);else{a[t]=n;try{return z(e,t,n,r,i,o)}catch(u){if(u.message.indexOf("Invalid argument")<0)throw u}}}function J(e,t,n,r,a){for(var i in n)!Ce.call(n,i)||!$(e,i,n[i],r[i],r,t,a);return r}function V(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&Y(t[n])}e.length&&(e.length=0)}function Y(e){e.configContext&&n(e.configContext.onunload)&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers&&c(e.controllers,function(e){n(e.onunload)&&e.onunload({preventDefault:o})}),e.children&&(Te(e.children)?c(e.children,Y):e.children.tag&&Y(e.children))}function Q(e,t){try{e.appendChild(xe.createRange().createContextualFragment(t))}catch(n){e.insertAdjacentHTML("beforeend",t),W(e)}}function W(e){if("SCRIPT"===e.tagName)e.parentNode.replaceChild(Z(e),e);else{var t=e.childNodes;if(t&&t.length)for(var n=0;n<t.length;n++)W(t[n])}return e}function Z(e){for(var t=document.createElement("script"),n=e.attributes,r=0;r<n.length;r++)t.setAttribute(n[r].name,n[r].value);return t.text=e.innerHTML,t}function ee(e,t,n){var r=e.childNodes[t];if(r){var a=1!==r.nodeType,i=xe.createElement("span");a?(e.insertBefore(i,r||null),i.insertAdjacentHTML("beforebegin",n),e.removeChild(i)):r.insertAdjacentHTML("beforebegin",n)}else Q(e,n);for(var o=[];e.childNodes[t]!==r;)o.push(e.childNodes[t]),t++;return o}function te(e,t){return function(n){n=n||event,f.redraw.strategy("diff"),f.startComputation();try{return e.call(t,n)}finally{le()}}}function ne(e){var t=Ie.indexOf(e);return t<0?Ie.push(e)-1:t}function re(e){function t(){return arguments.length&&(e=arguments[0]),e}return t.toJSON=function(){return e&&n(e.toJSON)?e.toJSON():e},t}function ae(e,t){function n(){return(e.controller||o).apply(this,t)||this}function r(n){for(var r=[n].concat(t),a=1;a<arguments.length;a++)r.push(arguments[a]);return e.view.apply(e,r)}e.controller&&(n.prototype=e.controller.prototype),r.$original=e.view;var a={controller:n,view:r};return t[0]&&null!=t[0].key&&(a.attrs={key:t[0].key}),a}function ie(e,t,n,r){if(!r){f.redraw.strategy("all"),f.startComputation(),qe[n]=t;var a;a=Ue=e?e:e={controller:o};var i=new(e.controller||o);return a===Ue&&(ze[n]=i,Xe[n]=e),le(),null===e&&oe(t,n),ze[n]}null==e&&oe(t,n),Ze&&(We=Ze)}function oe(e,t){qe.splice(t,1),ze.splice(t,1),Xe.splice(t,1),me(e),Ie.splice(ne(e),1),Le=[]}function ue(){Ve&&(Ve(),Ve=null),c(qe,function(e,t){var n=Xe[t];if(ze[t]){var r=[ze[t]];f.render(e,n.view?n.view(ze[t],r):"")}}),Ye&&(Ye(),Ye=null),$e=null,Je=new Date,f.redraw.strategy("diff")}function le(){"none"===f.redraw.strategy()?(Re--,f.redraw.strategy("diff")):f.endComputation()}function de(e){return e.slice(nt[f.route.mode].length)}function se(e,t,n){tt={};var r=n.indexOf("?");r!==-1&&(tt=ve(n.substr(r+1,n.length)),n=n.substr(0,r));var a=Object.keys(t),i=a.indexOf(n);if(i!==-1)return f.mount(e,t[a[i]]),!0;for(var o in t)if(Ce.call(t,o)){if(o===n)return f.mount(e,t[o]),!0;var u=new RegExp("^"+o.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(u.test(n))return n.replace(u,function(){var n=o.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2);c(n,function(e,t){tt[e.replace(/:|\./g,"")]=decodeURIComponent(r[t])}),f.mount(e,t[o])}),!0}}function fe(e){if(e=e||event,!(e.ctrlKey||e.metaKey||e.shiftKey||2===e.which)){e.preventDefault?e.preventDefault():e.returnValue=!1;var t,n=e.currentTarget||e.srcElement;for(t="pathname"===f.route.mode&&n.search?ve(n.search.slice(1)):{};n&&!/a/i.test(n.nodeName);)n=n.parentNode;Re=0,f.route(n[f.route.mode].slice(nt[f.route.mode].length),t)}}function ce(){"hash"!==f.route.mode&&Se.hash?Se.hash=Se.hash:e.scrollTo(0,0)}function pe(e,n){var a={},i=[];for(var o in e)if(Ce.call(e,o)){var u=n?n+"["+o+"]":o,l=e[o];if(null===l)i.push(encodeURIComponent(u));else if(r(l))i.push(pe(l,u));else if(Te(l)){var d=[];a[u]=a[u]||{},c(l,function(e){a[u][e]||(a[u][e]=!0,d.push(encodeURIComponent(u)+"="+encodeURIComponent(e)))}),i.push(d.join("&"))}else l!==t&&i.push(encodeURIComponent(u)+"="+encodeURIComponent(l))}return i.join("&")}function ve(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));var t=e.split("&"),n={};return c(t,function(e){var t=e.split("="),r=decodeURIComponent(t[0]),a=2===t.length?decodeURIComponent(t[1]):null;null!=n[r]?(Te(n[r])||(n[r]=[n[r]]),n[r].push(a)):n[r]=a}),n}function me(e){var n=ne(e);V(e.childNodes,He[n]),He[n]=t}function ge(e,t){var n=f.prop(t);return e.then(n),n.then=function(n,r){return ge(e.then(n,r),t)},n["catch"]=n.then.bind(null,null),n}function he(e,t){function a(e){l=e||lt,s.map(function(e){l===ut?e.resolve(d):e.reject(d)})}function i(e,t,a,i){if((null!=d&&r(d)||n(d))&&n(e))try{var o=0;e.call(d,function(e){o++||(d=e,t())},function(e){o++||(d=e,a())})}catch(u){f.deferred.onerror(u),d=u,a()}else i()}function o(){var r;try{r=d&&d.then}catch(s){return f.deferred.onerror(s),d=s,l=ot,o()}l===ot&&f.deferred.onerror(d),i(r,function(){l=it,o()},function(){l=ot,o()},function(){try{l===it&&n(e)?d=e(d):l===ot&&n(t)&&(d=t(d),l=it)}catch(o){return f.deferred.onerror(o),d=o,a()}d===u?(d=TypeError(),a()):i(r,function(){a(ut)},a,function(){a(l===it&&ut)})})}var u=this,l=0,d=0,s=[];u.promise={},u.resolve=function(e){return l||(d=e,l=it,o()),u},u.reject=function(e){return l||(d=e,l=ot,o()),u},u.promise.then=function(e,t){var n=new he(e,t);return l===ut?n.resolve(d):l===lt?n.reject(d):s.push(n),n.promise}}function ye(e){return e}function we(n){var r=n.callbackName||"mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),a=xe.createElement("script");e[r]=function(i){a.parentNode.removeChild(a),n.onload({type:"load",target:{responseText:i}}),e[r]=t},a.onerror=function(){return a.parentNode.removeChild(a),n.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),e[r]=t,!1},a.onload=function(){return!1},a.src=n.url+(n.url.indexOf("?")>0?"&":"?")+(n.callbackKey?n.callbackKey:"callback")+"="+r+"&"+pe(n.data||{}),xe.body.appendChild(a)}function be(t){var a=new e.XMLHttpRequest;if(a.open(t.method,t.url,!0,t.user,t.password),a.onreadystatechange=function(){4===a.readyState&&(a.status>=200&&a.status<300?t.onload({type:"load",target:a}):t.onerror({type:"error",target:a}))},t.serialize===JSON.stringify&&t.data&&"GET"!==t.method&&a.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.deserialize===JSON.parse&&a.setRequestHeader("Accept","application/json, text/*"),r(t.headers))for(var o in t.headers)Ce.call(t.headers,o)&&a.setRequestHeader(o,t.headers[o]);if(n(t.config)){var u=t.config(a,t);null!=u&&(a=u)}var l="GET"!==t.method&&t.data?t.data:"";if(l&&!i(l)&&l.constructor!==e.FormData)throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`");return a.send(l),a}function Pe(e){return e.dataType&&"jsonp"===e.dataType.toLowerCase()?we(e):be(e)}function ke(e,t,n){if("GET"===e.method&&"jsonp"!==e.dataType){var r=e.url.indexOf("?")<0?"?":"&",a=pe(t);e.url+=a?r+a:""}else e.data=n(t)}function Oe(e,t){return t&&(e=e.replace(/:[a-z]\w+/gi,function(e){var n=e.slice(1),r=t[n]||e;return delete t[n],r})),e}f.version=function(){return"v0.2.8"};var xe,Se,Ee,Me,Ce={}.hasOwnProperty,Ke={}.toString,Te=Array.isArray||function(e){return"[object Array]"===Ke.call(e)},De={AREA:1,BASE:1,BR:1,COL:1,COMMAND:1,EMBED:1,HR:1,IMG:1,INPUT:1,KEYGEN:1,LINK:1,META:1,PARAM:1,SOURCE:1,TRACK:1,WBR:1};f.deps=function(t){return u(e=t||window),e},f.deps.factory=f.factory=a,f.deps(e);var Ae=1,Be=2,je=3,Re=0;f.startComputation=function(){Re++},f.endComputation=function(){Re>1?Re--:(Re=0,f.redraw())};var Ge,Le=[],Fe=!1,Ne={list:1,style:1,form:1,type:1,width:1,height:1},_e={appendChild:function(e){Ge===t&&(Ge=xe.createElement("html")),xe.documentElement&&xe.documentElement!==e?xe.replaceChild(e,xe.documentElement):xe.appendChild(e),this.childNodes=xe.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},Ie=[],He={};f.render=function(e,n,r){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var a,i=[],o=ne(e),u=e===xe;a=u||e===xe.documentElement?_e:e,u&&"html"!==n.tag&&(n={tag:"html",attrs:{},children:n}),He[o]===t&&V(a.childNodes),r===!0&&me(e),He[o]=U(a,null,t,t,n,He[o],!1,0,null,t,i),c(i,function(e){e()})},f.trust=function(e){return e=new String(e),e.$trusted=!0,e},f.prop=function(e){return(null!=e&&(r(e)||n(e))||"undefined"!=typeof Promise&&e instanceof Promise)&&n(e.then)?ge(e):re(e)};var Ue,qe=[],Xe=[],ze=[],$e=null,Je=0,Ve=null,Ye=null,Qe=16;f.component=function(e){for(var t=new Array(arguments.length-1),n=1;n<arguments.length;n++)t[n-1]=arguments[n];return ae(e,t)};var We,Ze;f.mount=f.module=function(e,t){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var r=qe.indexOf(e);r<0&&(r=qe.length);var a=!1,i={preventDefault:function(){a=!0,Ve=Ye=null}};return c(Le,function(e){e.handler.call(e.controller,i),e.controller.onunload=null}),a?c(Le,function(e){e.controller.onunload=e.handler}):Le=[],ze[r]&&n(ze[r].onunload)&&ze[r].onunload(i),ie(t,e,r,a)};var et=!1;f.redraw=function(t){if(!et){et=!0,t&&(Fe=!0);try{$e&&!t?(Ee===e.requestAnimationFrame||new Date-Je>Qe)&&($e>0&&Me($e),$e=Ee(ue,Qe)):(ue(),$e=Ee(function(){$e=null},Qe))}finally{et=Fe=!1}}},f.redraw.strategy=f.prop(),f.withAttr=function(e,t,n){return function(r){r=r||window.event;var a=r.currentTarget||this,i=n||this,o=e in a?a[e]:a.getAttribute(e);t.call(i,o)}};var tt,nt={pathname:"",hash:"#",search:"?"},rt=o,at=!1;f.route=function(t,n,r,a){if(0===arguments.length)return We;if(3===arguments.length&&i(n)){rt=function(e){var a=We=de(e);if(!se(t,r,a)){if(at)throw new Error("Ensure the default route matches one of the routes defined in m.route");at=!0,f.route(n,!0),at=!1}};var o="hash"===f.route.mode?"onhashchange":"onpopstate";return e[o]=function(){var e=Se[f.route.mode];"pathname"===f.route.mode&&(e+=Se.search),We!==de(e)&&rt(e)},Ve=ce,void e[o]()}if(t.addEventListener||t.attachEvent){var u="pathname"!==f.route.mode?Se.pathname:"";return t.href=u+nt[f.route.mode]+a.attrs.href,void(t.addEventListener?(t.removeEventListener("click",fe),t.addEventListener("click",fe)):(t.detachEvent("onclick",fe),t.attachEvent("onclick",fe)))}if(i(t)){Ze=We,We=t;var l,d=n||{},s=We.indexOf("?");l=s>-1?ve(We.slice(s+1)):{};for(var c in d)Ce.call(d,c)&&(l[c]=d[c]);var p,v=pe(l);p=s>-1?We.slice(0,s):We,v&&(We=p+(p.indexOf("?")===-1?"?":"&")+v);var m=(3===arguments.length?r:n)===!0||Ze===We;if(e.history.pushState){var g=m?"replaceState":"pushState";Ve=ce,Ye=function(){try{e.history[g](null,xe.title,nt[f.route.mode]+We)}catch(t){Se[f.route.mode]=We}},rt(nt[f.route.mode]+We)}else Se[f.route.mode]=We,rt(nt[f.route.mode]+We);Ze=null}},f.route.param=function(e){if(!tt)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return e?tt[e]:tt},f.route.mode="search",f.route.buildQueryString=pe,f.route.parseQueryString=ve,f.deferred=function(){var e=new he;return e.promise=ge(e.promise),e};var it=1,ot=2,ut=3,lt=4;return f.deferred.onerror=function(e){if("[object Error]"===Ke.call(e)&&!/ Error/.test(e.constructor.toString()))throw Re=0,e},f.sync=function(e){function t(e,t){return function(o){return a[e]=o,t||(i="reject"),0===--r&&(n.promise(a),n[i](a)),o}}var n=f.deferred(),r=e.length,a=[],i="resolve";return e.length>0?c(e,function(e,n){e.then(t(n,!0),t(n,!1))}):n.resolve([]),n.promise},f.request=function(e){e.background!==!0&&f.startComputation();var t,n,r,a=new he,i=e.dataType&&"jsonp"===e.dataType.toLowerCase();return i?(t=e.serialize=n=e.deserialize=ye,r=function(e){return e.responseText}):(t=e.serialize=e.serialize||JSON.stringify,n=e.deserialize=e.deserialize||JSON.parse,r=e.extract||function(e){return e.responseText.length||n!==JSON.parse?e.responseText:null}),e.method=(e.method||"GET").toUpperCase(),e.url=Oe(e.url,e.data),ke(e,e.data,t),e.onload=e.onerror=function(t){try{t=t||event;var i=n(r(t.target,e));"load"===t.type?(e.unwrapSuccess&&(i=e.unwrapSuccess(i,t.target)),Te(i)&&e.type?c(i,function(t,n){i[n]=new e.type(t)}):e.type&&(i=new e.type(i)),a.resolve(i)):(e.unwrapError&&(i=e.unwrapError(i,t.target)),a.reject(i))}catch(o){a.reject(o),f.deferred.onerror(o)}finally{e.background!==!0&&f.endComputation()}},Pe(e),a.promise=ge(a.promise,e.initialValue),a.promise},f})},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=.7*e.width,r=.7*e.height,a=v["default"].miniKey2pos(t),i=[a[0]*(n/v["default"].miniColumns),a[1]*(r/v["default"].miniRows)];return i}function i(e,t,n){var r=v["default"].key2pos(n),a=[r[0]*(e.width/v["default"].columns),r[1]*e.height*.5],i=[e.left-t.left,e.top-t.top];return[i[0]+a[0],i[1]+a[1]]}function o(e,t){return[e[0]-t[0],e[1]-t[1]]}function u(e,t){return t[0]}function l(e,t,n){return{key:e,distance:n,color:t.color,number:t.number}}function d(e,t){var n,r,d,s,f=t.animation.current,c=v["default"].findPov(t.povSide,t.turnSide),p=v["default"].vectorByPov(c),m=(t.bounds(),t.topBounds()),h=t.boardBounds(),y=h.width,w=(h.height,m.width),b=m.height,P=.0625*w,k=.14*b,O=.0625*y,x={},S=[],E={},M={},C=v["default"].discardByPov(c),K=v["default"].drawByPov(c),T=v["default"].topKey2pos(K),D=v["default"].topKey2pos(C),A=[w*p[0],b*p[1]+("up"===c?-k:"left"===c?-k/2:0)],B=[12*P,b-k],j=[P*D[0],k*D[1]],R=[P*T[0],k*T[1]],G=[1*P,1*k],L=[],F=[],N=[],_=[];for(n=0;n<v["default"].allAllowedBoardKeys.length;n++){r=v["default"].allAllowedBoardKeys[n],d=t.pieces[r],s=e.pieces[r];var I=i(h,m,r);!d&&s?L.push(l(r,s,I)):d&&!s&&F.push(l(r,d,I))}for(n=0;n<v["default"].miniAllKeys.length;n++){r=v["default"].miniAllKeys[n],d=t.opens.layout?t.opens.layout.layout[r]:null,s=e.opens.layout?e.opens.layout.layout[r]:null;var H=a(m,r);d&&!s?_.push(l(r,d,H)):!d&&s&&N.push(l(r,s,H))}var U,q,X;return"down"!==c||t.spectator?f.hint===g["default"].drawMiddle?(U=[12*P,b],q=A,X=[q[0]-U[0],q[1]-U[1]],x[v["default"].middleCount]=[X,X,!0]):f.hint===g["default"].discard?(U=[P*D[0],k*D[1]],q=A,X=[q[0]-U[0],q[1]-U[1]],x[C]=[X,X]):f.hint===g["default"].drawLeft?(U=[P*T[0],k*T[1]],q=A,X=[q[0]-U[0],q[1]-U[1]],x[g["default"].drawLeft+K]=[X,X,!0],M.piece=e.discards[K]):f.hint===g["default"].leaveTaken?(U=[P*T[0],k*T[1]],q=A,X=[q[0]-U[0],q[1]-U[1]],x[K]=[X,X]):f.hint===g["default"].openSeries?_.forEach(function(e,t){q=A,q=o(q,G),q=o(q,e.distance),U=[0,0],X=[q[0]-U[0],q[1]-U[1]],x[e.key]=[X,X],E[e.key]=[1.75,1.75]}):f.hint===g["default"].collectOpen&&N.forEach(function(e,t){q=A,q=o(q,G),q=o(q,e.distance),U=[0,0],X=[q[0]-U[0],q[1]-U[1]],x[e.key]=[X,X,!0],M[e.key]=e}):f.hint===g["default"].drawMiddle&&F[0]?(r=F[0].key,U=F[0].distance,U=o(U,B),q=[0,0],X=[q[0]-U[0],q[1]-U[1]],x[r]=[X,X]):f.hint===g["default"].discard&&L[0]?(q=L[0].distance,q=o(q,j),U=[0,0],X=[q[0]-U[0],q[1]-U[1]],x[C]=[X,X]):f.hint===g["default"].leaveTaken?L[0]?(q=L[0].distance,q=o(q,R),U=[0,0],X=[q[0]-U[0],q[1]-U[1]],x[K]=[X,X]):(U=[P*T[0],k*T[1]],q=A,X=[q[0]-U[0],q[1]-U[1]],x[K]=[X,X]):f.hint===g["default"].openSeries&&_.forEach(function(e,t){var n=u(e,L.filter(v["default"].partial(v["default"].pieceEqual,e)));L.splice(L.indexOf(n),1),n&&(q=n.distance,q=o(n.distance,[O,0]),q=o(q,G),q=o(q,e.distance),U=[0,0],X=[q[0]-U[0],q[1]-U[1]],x[e.key]=[X,X],E[e.key]=[1.75,1.75])}),{anims:x,fadings:S,scales:E,extra:M}}function s(e,t){return Math.round(e*t)/t}function f(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(t<=0)e.animation.current={},e.render();else{var n,r=h.easeInOutCubic(t);for(var a in e.animation.current.anims)n=e.animation.current.anims[a],n[1]=[s(n[0][0]*r,10),s(n[0][1]*r,10)],n[2]&&(n[1]=[n[0][0]-n[1][0],n[0][1]-n[1][1]]);var i;for(i in e.animation.current.fadings)e.animations.current.fadings[i].opacity=s(r,100);for(i in e.animation.current.scales)n=e.animation.current.scales[i],n[0]=1+s(.7*r,10),n[1]=1+s(.7*r,10);e.render(),v["default"].requestAnimationFrame(function(){f(e)})}}}function c(e,t){var n,r={pieces:{},opens:{},middles:{},discards:{}};for(n in t.pieces)t.pieces[n]&&(r.pieces[n]={color:t.pieces[n].color,number:t.pieces[n].number});for(n in t.discards)t.discards[n]&&t.discards[n][0]&&(r.discards[n]={color:t.discards[n][0].color,number:t.discards[n][0].number});if(t.opens.layout){var a;r.opens.layout={layout:{}};for(n in t.opens.layout.layout)a=t.opens.layout.layout[n],r.opens.layout.layout[n]={color:a.color,number:a.number}}var i=e(),o=d(r,t);if(Object.keys(o.anims).length>0||o.fadings.length>0){var u=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:o.anims,fadings:o.fadings,scales:o.scales,extra:o.extra},u||f(t)}else t.renderRAF();return i}var p=e("./util"),v=r(p),m=e("./move"),g=r(m),h={easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t){return function(){var n=[t].concat(Array.prototype.slice.call(arguments,0));if(t.animation.enabled)return c(v["default"].partialApply(e,n),t);var r=e.apply(null,n);return t.renderRAF(),r}}},{"./move":12,"./util":16}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=e("./board"),i=r(a);t.exports=function(e){return{set:e.set,getPieceGroups:function(){return i["default"].getPieceGroups(e.data)},sortPairs:e.sortPairs,apiMove:e.apiMove,apiDrawMiddleEnd:e.apiDrawMiddleEnd,playOpenSeries:e.playOpenSeries,playOpenPairs:e.playOpenPairs,playLeaveTaken:e.playLeaveTaken,stop:e.stop,getPieceGroupSeries:e.getPieceGroupSeries,getPieceGroupPairs:e.getPieceGroupPairs,getFen:e.getFen}}},{"./board":5}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){var t={};for(var n in e.pieces){var r=e.pieces[n];r&&(t[r.key]?t[r.key]++:t[r.key]=1,delete e.pieces[n])}var a=1;for(var i in t){var o=t[i];a=te["default"].nextIteratorForGroup(a,o);for(var u=0;u<o;u++)e.pieces[te["default"].iterator2Key(a+2*u)]=ie["default"].readPiece(i).piece;a+=2*o+1}}function o(e){if(R(e)){var t=e.middles[te["default"].gosterge],n=Q(e);if(n=n.filter(function(n){return ue["default"].series(n.map(function(t){return e.pieces[t]}),t)}),n.length>0){var r=$(n.map(function(t){return t.map(function(t){return e.pieces[t]})}));return c(e,n),de(te["default"].partial(e.movable.events.after,re["default"].openSeries,le(r))),e.animation.current.hint=re["default"].openSeries,!0}}return!1}function u(e){if(G(e)){var t=e.middles[te["default"].gosterge],n=Q(e);if(n=n.filter(function(n){return ue["default"].pairs(n.map(function(t){return e.pieces[t]}),t)}),n.length>0){var r=$(n.map(function(t){return t.map(function(t){return e.pieces[t]})}));return f(e,n),de(te["default"].partial(e.movable.events.after,re["default"].openPairs,le(r))),e.animation.current.hint=re["default"].openSeries,!0}}return!1}function l(e,t){return t=ie["default"].readPiece(t).piece,!(!L(e)||!b(e,t))&&(de(te["default"].partial(e.movable.events.after,re["default"].leaveTaken)),e.animation.current.hint=re["default"].leaveTaken,!0)}function d(e,t){var n=te["default"].middleCount;g(e,n),s(e,t)}function s(e,t){"string"==typeof t&&(t=ie["default"].readPiece(t).piece),e.middleHolder.piece=t,p(e)}function f(e,t){var n=t.map(function(t){return t.map(function(t){return e.pieces[t]})}),r=$(n);de(te["default"].partial(e.events.move,re["default"].openPairs,le(r))),t.forEach(function(t){return t.map(function(t){return delete e.pieces[t]})});var a=e.opens.pairs.concat(n);e.opens.pairs=a,e.opens.relayout(e)}function c(e,t){var n=t.map(function(t){return t.map(function(t){return e.pieces[t]})}),r=$(n);de(te["default"].partial(e.events.move,re["default"].openSeries,le(r))),t.forEach(function(t){return t.map(function(t){return delete e.pieces[t]})});var a=e.opens.series.concat(n);e.opens.series=a,e.opens.relayout(e)}function p(e){var t=e.middleHolder.key,n=e.middleHolder.piece;t&&n&&(e.pieces[t]=n,e.lastMove=[te["default"].middleCount],e.middleHolder.current=!1,e.middleHolder.key=null,e.middleHolder.piece=null)}function v(e,t,n){var r=H(e,t);if(r.length>0){var a=r[0].map(function(t,a){var i=r[0].length-a-1,o=te["default"].decBoardKey(n,2*i);return[t,o,e.pieces[t]]}),i=a.every(function(t){var n=Z(t,3),r=(n[0],n[1]);n[2];return te["default"].isAllAllowedBoardKey(r)&&[r,te["default"].decBoardKey(r,-1)].every(function(t){return!e.pieces[t]||a.filter(function(e){var n=Z(e,3),r=n[0];n[1],n[2];return r===t}).length>0})});return!!i&&(a.map(function(t){var n=Z(t,3),r=n[0],a=n[1],i=n[2];return delete e.pieces[r],[r,a,i]}).map(function(t){var n=Z(t,3),r=(n[0],n[1]),a=n[2];e.pieces[r]=a}),!0)}return!1}function m(e,t,n){if(t===n||!e.pieces[t])return!1;var r=e.pieces[n];return e.pieces[n]=e.pieces[t],e.pieces[t]=r,!0}function g(e,t){e.middles[te["default"].middleCount]--,e.middleHolder.current=!0;var n=U(e);return e.middleHolder.key=n,!0}function h(e,t,n){if(!n||e.pieces[n]){var r=U(e);n=r}return de(te["default"].partial(e.events.move,re["default"].drawMiddleEnd)),e.middleHolder.key=n,p(e),!0}function y(e,t){return de(te["default"].partial(e.events.move,re["default"].drawMiddle)),e.middles[te["default"].middleCount]--,e.middleHolder.current=!0,!0}function w(e,t,n){return!e.pieces[n]&&(de(te["default"].partial(e.events.move,re["default"].drawLeft)),e.pieces[n]=e.discards[te["default"].discards[1]][0],e.discards[te["default"].discards[1]].shift(),!0)}function b(e,t){var n=q(e,t);if(!n)return!1;de(te["default"].partial(e.events.move,re["default"].leaveTaken));var r=te["default"].findPov(e.povSide,e.turnSide);return delete e.pieces[n],e.discards[te["default"].drawByPov(r)].unshift(t),!0}function P(e,t,n){if(n&&te["default"].isBoardKey(t)&&te["default"].isBoardKey(n)&&T(e,t,n)){if(v(e,t,n))return!0;if(m(e,t,n))return!0;
}}function k(e,t){if(te["default"].isMiddleKey(t)&&A(e,t))return y(e,t),!0}function O(e,t,n){if(te["default"].isMiddleKey(t)&&B(e,t))return h(e,t,n),!0}function x(e,t,n){if(n&&te["default"].isBoardKey(n)&&te["default"].isDrawLeftKey(t)&&j(e,t,n)&&w(e,t,n))return de(te["default"].partial(e.movable.events.after,re["default"].drawLeft)),!0}function S(e,t,n){n||(te["default"].isMiddleKey(t)?k(e,t)&&M(e,t):te["default"].isDrawLeftKey(t)&&j(e)&&M(e,t))}function E(e,t){e.selected?(t?e.selected!==t&&(P(e,e.selected,t)||x(e,e.selected,t)||O(e,e.selected,t)):O(e,e.selected,t),M(e,null)):K(e,t)&&M(e,t)}function M(e,t){if(e.selected=t,t&&te["default"].isBoardKey(t))if(I(e,t)){var n=e.middles[te["default"].gosterge];e.openable.dests=ue["default"].compute(e.opens,e.pieces[t],n)}else e.openable.dests=[];else e.openable.dests=[]}function C(e){return e.povSide===e.turnSide}function K(e,t){var n=e.pieces[t];return n&&e.movable.board}function T(e,t,n){return t!=n&&K(e,t)}function D(e){return C(e)}function A(e,t){return D(e)&&!e.middleHolder.current&&te["default"].containsX(e.movable.dests,re["default"].drawMiddle)}function B(e){return e.middleHolder.current}function j(e,t,n){return D(e)&&!B(e)&&te["default"].containsX(e.movable.dests,re["default"].drawLeft)}function R(e){return C(e)&&te["default"].containsX(e.movable.dests,re["default"].openSeries)}function G(e){return C(e)&&te["default"].containsX(e.movable.dests,re["default"].openPairs)}function L(e){return C(e)&&te["default"].containsX(e.movable.dests,re["default"].leaveTaken)}function F(e){return C(e)&&te["default"].containsX(e.movable.dests,re["default"].collectOpen)}function N(e){E(e,null)}function _(e){e.movable.side=null,e.movable.dests=[],e.openable.dests=[],e.movable.board=!1,N(e)}function I(e,t){var n=e.pieces[t];return!(!n||e.povSide!==e.turnSide)}function H(e,t){var n=e.middles[te["default"].gosterge],r=Q(e);return r=r.filter(function(e){return e[e.length-1]===t}),r=r.filter(function(t){return ue["default"].series(t.map(function(t){return e.pieces[t]}),n)||ue["default"].pairs(t.map(function(t){return e.pieces[t]}),n)})}function U(e){var t=te["default"].allAllowedBoardKeys.slice(1),n=te["default"].allAllowedBoardKeys.slice(2),r=te["default"].allAllowedBoardKeys.map(function(e,r){return[e,t[r],n[r]]}).filter(function(t){var n=Z(t,3),r=n[0],a=n[1],i=n[2];return r&&a&&i&&!e.pieces[r]&&!e.pieces[a]&&!e.pieces[i]});return r[r.length-1][1]}function q(e,t){return te["default"].allAllowedBoardKeys.filter(function(n){return e.pieces[n]&&te["default"].pieceEqual(e.pieces[n],t)})[0]}function X(e,t,n,r){var a=z(e,t,n);if(!a)return a;var i=te["default"].decBoardKey(a);return i!==r&&e.pieces[i]&&(a=i),te["default"].notAllowedBoardKeys.indexOf(a)!==-1?null:a}function z(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.floor(te["default"].columns*((t[0]-n.left)/n.width)),a=Math.floor(te["default"].rows*((t[1]-n.top)/n.height));return a>=0&&a<te["default"].rows&&r>=0&&r<te["default"].columns?te["default"].pos2key([r,a]):void 0}}function $(e){return e.map(function(e){return e.map(function(e){return e.key}).join("")}).join(" ")}function J(e){var t=e.middles[te["default"].gosterge],n=e.withTore,r=Y(e).filter(function(e){return ue["default"].series(e,t,n)});return $(r)}function V(e){var t=e.middles[te["default"].gosterge],n=Y(e).filter(function(e){return ue["default"].pairs(e,t)});return $(n)}function Y(e){return Q(e).map(function(t){return t.map(function(t){return e.pieces[t]})})}function Q(e){var t=te["default"].pos2key([te["default"].columns-1,0]),n=te["default"].allKeys.slice(1),r=te["default"].allKeys.map(function(e,t){return[e,n[t]]}).reduce(function(n,r){var a=Z(n,2),i=a[0],o=a[1],u=Z(r,2),l=u[0],d=u[1];return e.pieces[l]&&i.push(l),(l&&!e.pieces[l]&&d&&!e.pieces[d]||l===t)&&0!==i.length&&(o.push(i),i=[]),[i,o]},[[],[]]),a=Z(r,2),i=a[0],o=a[1];return 0!==i.length&&o.push(i),o}var W,Z=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){a=!0,i=l}finally{try{!r&&u["return"]&&u["return"]()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ee=e("./util"),te=r(ee),ne=e("./move"),re=r(ne),ae=e("./pieces"),ie=r(ae),oe=e("./open"),ue=r(oe),le=te["default"].wrapGroup,de=te["default"].callUserFunction;t.exports=(W={playOpenSeries:o,playOpenPairs:u,playLeaveTaken:l,apiDrawMiddleEnd:s},a(W,"apiDrawMiddleEnd",s),a(W,"apiForceDrawMiddleEnd",d),a(W,"apiForceDrawMiddleEnd",d),a(W,"userMove",P),a(W,"userDrawLeft",x),a(W,"userBeginDrawMiddle",k),a(W,"userEndDrawMiddle",O),a(W,"selectSquare",E),a(W,"selectTop",S),a(W,"setSelected",M),a(W,"sortPairs",i),a(W,"canOpenSeries",R),a(W,"canOpenPairs",G),a(W,"canLeaveTaken",L),a(W,"canCollectOpen",F),a(W,"stop",_),a(W,"cancelMove",N),a(W,"isDroppableOpens",I),a(W,"findBoardDragGroup",H),a(W,"getKeyAtDomPos",z),a(W,"getKeyAtDomPosOnPiece",X),a(W,"getPieceGroups",Y),a(W,"getPieceGroupSeries",J),a(W,"getPieceGroupPairs",V),W)},{"./move":12,"./open":13,"./pieces":14,"./util":16}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=e("merge"),i=r(a),o=e("./pieces"),u=r(o);t.exports=function(e,t){if(t&&(i["default"].recursive(e,t),e.fen)){e.spectator&&(e.fen=e.povSide[0]+e.fen.slice(1)),e.animationHint&&(e.animation.current.hint=e.animationHint,delete e.animationHint);var n=u["default"].read(e.fen);e.pieces=n.pieces,e.discards=n.discards,e.opens=n.opens,e.middles=n.middles,delete e.fen}}},{"./pieces":14,merge:1}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=e("./table"),i=r(a),o=e("./board"),u=r(o),l=e("./data"),d=r(l),s=e("./configure"),f=r(s),c=e("./util"),p=r(c),v=e("./anim"),m=r(v),g=e("./drag"),h=r(g),y=e("./pieces"),w=r(y);t.exports=function(e){var t=this;this.data=(0,d["default"])(e),this.data.flipPiece=function(e,t){var n=this;t&&!this.flippable.current.orig&&(this.flippable.current={orig:e},this.renderRAF(),setTimeout(function(){n.flippable.current.flip=!0,n.renderRAF(),setTimeout(function(){t.flip=!t.flip,n.flippable.current={},n.renderRAF()},600)},10))}.bind(this.data),this.getFen=function(){return w["default"].write(t.data.pieces)},this.getPieceGroupSeries=function(){return u["default"].getPieceGroupSeries(t.data)},this.getPieceGroupPairs=function(){return u["default"].getPieceGroupPairs(t.data)},this.set=(0,m["default"])(f["default"],this.data),this.apiMove=(0,m["default"])(i["default"].apiMove,this.data),this.apiDrawMiddleEnd=(0,m["default"])(u["default"].apiDrawMiddleEnd,this.data),this.playOpenSeries=(0,m["default"])(u["default"].playOpenSeries,this.data),this.playOpenPairs=(0,m["default"])(u["default"].playOpenPairs,this.data),this.playLeaveTaken=(0,m["default"])(u["default"].playLeaveTaken,this.data),this.sortPairs=(0,m["default"])(u["default"].sortPairs,this.data),this.canLeaveTaken=p["default"].partial(u["default"].canLeaveTaken,this.data),this.canCollectOpen=p["default"].partial(u["default"].canCollectOpen,this.data),this.canOpenSeries=p["default"].partial(u["default"].canOpenSeries,this.data),this.canOpenPairs=p["default"].partial(u["default"].canOpenPairs,this.data),this.stop=(0,m["default"])(function(e){u["default"].stop(e),h["default"].cancel(e)},this.data),this.onunload=function(){}}},{"./anim":3,"./board":5,"./configure":6,"./data":8,"./drag":9,"./pieces":14,"./table":15,"./util":16}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=e("merge"),i=(r(a),e("./pieces")),o=r(i),u=e("./configure"),l=r(u);t.exports=function(e){var t={povSide:"east",turnSide:"east",lastMove:null,withTore:!1,pieces:o["default"].readBoard(o["default"].mixed),discards:o["default"].readDiscards(o["default"].initialDiscards,"east"),opens:o["default"].readOpenGroups(o["default"].initialOpenGroups),middles:o["default"].readMiddles(o["default"].initialMiddles),selected:null,middleHolder:{current:!1,key:null,piece:null},viewOnly:!1,animation:{enabled:!0,duration:500,current:{}},draggable:{enabled:!0,distance:3,current:{}},movable:{board:!0,free:!0,events:{after:function(e,t){}}},flippable:{enabled:!0,current:{}},openable:{dests:[]},events:{move:function(e,t){}}};return(0,l["default"])(t,e||{}),t}},{"./configure":6,"./pieces":14,merge:1}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g["default"].rows,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g["default"].columns;return{left:t.left+t.width*n[0]/a,top:t.top+t.height*n[1]/r,width:t.width/a,height:t.height/r}}function i(e,t){if((void 0===t.button||0===t.button)&&(t.stopPropagation(),t.preventDefault(),!e.viewOnly)){s=t.target;var n=e.selected,r=g["default"].eventPosition(t),i=e.boardBounds(),u=e.opensBounds(),l=e.topBounds(),d=c["default"].getKeyAtDomPosOnPiece(e,r,i);c["default"].selectSquare(e,d),d||(d=v["default"].getDrawKeyAtDomPos(e,r,l))&&c["default"].selectTop(e,d,n),!d&&n&&((d=v["default"].getOpensKeyAtDomPos(e,r,u))?v["default"].dropOpens(e,n,d):(d=v["default"].getDiscardKeyAtDomPos(e,r,l))&&v["default"].dropTop(e,n,d));var f=e.selected===d;if(f&&v["default"].isDraggable(e,d)){var p=g["default"].isBoardKey(d)?a(e,i,g["default"].key2pos(d)):a(e,l,g["default"].topKey2pos(d),g["default"].topRows,g["default"].topColumns),m=c["default"].findBoardDragGroup(e,d)[0];e.draggable.current={dragGroup:m,orig:d,rel:r,epos:r,pos:[0,0],dec:[r[0]-(p.left+p.width/2),r[1]-(p.top+p.height/2)],boardBounds:i,opensBounds:u,topBounds:l,started:!1}}o(e)}}function o(e){g["default"].requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(!t.started&&g["default"].distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=c["default"].getKeyAtDomPosOnPiece(e,t.epos,t.boardBounds,t.orig),!t.over&&g["default"].isBoardKey(t.orig)&&(t.over=v["default"].getOpensKeyAtDomPos(e,t.epos,t.opensBounds)||v["default"].getDiscardKeyAtDomPos(e,t.epos,t.topBounds)))),e.render(),t.orig&&o(e)})}function u(e,t){e.draggable.current.orig&&(e.draggable.current.epos=g["default"].eventPosition(t))}function l(e,t){var n=e.draggable,r=n.current?n.current.orig:null;if(r){var a=n.current.over;n.current.started&&(c["default"].setSelected(e,null),c["default"].userMove(e,r,a)||v["default"].dropOpens(e,r,a)||v["default"].dropTop(e,r,a)||c["default"].userDrawLeft(e,r,a)||c["default"].userEndDrawMiddle(e,r,a)),n.current={}}}function d(e){e.draggable.current.orig&&(e.draggable.current={},c["default"].selectSquare(e,null))}var s,f=e("./board"),c=r(f),p=e("./table"),v=r(p),m=e("./util"),g=r(m);t.exports={start:i,move:u,end:l,cancel:d}},{"./board":5,"./table":15,"./util":16}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){t.stopPropagation(),t.preventDefault(),l["default"].cancelMove(e);var n=s["default"].eventPosition(t),r=e.boardBounds(),a=l["default"].getKeyAtDomPosOnPiece(e,n,r),i=e.pieces[a];e.flipPiece(a,i)}function i(e,t){}function o(e,t){}var u=e("./board"),l=r(u),d=e("./util"),s=r(d);t.exports={start:a,move:i,end:o}},{"./board":5,"./util":16}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){u["default"].render(e,(0,f["default"])(t),!0)}function i(e,t){var n=new d["default"](t);return u["default"].render(e,(0,f["default"])(n)),(0,h["default"])(n)}var o=e("mithril"),u=r(o),l=e("./ctrl"),d=r(l),s=e("./view"),f=r(s),c=e("./util"),p=r(c),v=e("./move"),m=r(v),g=e("./api"),h=r(g),y=e("./anim"),w=r(y),b=e("./drag"),P=r(b);t.exports=i,t.exports.render=a,t.exports.controller=d["default"],t.exports.view=f["default"],t.exports.util=p["default"],t.exports.move=m["default"],t.exports.anim=w["default"],t.exports.drag=P["default"]},{"./anim":3,"./api":4,"./ctrl":7,"./drag":9,"./move":12,"./util":16,"./view":17,mithril:2}],12:[function(e,t,n){"use strict";var r="dm",a="dl",i="dd",o="lt",u="ss",l="os",d="op",s="co",f="dos",c="dop",p="dds",v="ddp",m="l",g="r",h="p";t.exports={drawMiddle:r,drawLeft:a,discard:i,leaveTaken:o,sign:u,openSeries:l,openPairs:d,collectOpen:s,dropOpenSeries:f,dropOpenPairs:c,dropLeft:m,dropRight:g,dropReplace:h,discardEndSeries:p,discardEndPairs:v}},{}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return e.length===t.length&&e.every(function(e,n){return e===t[n]})}function i(e,t){return t.every(function(t,n){return t.color===e[n]})}function o(e,t){if(e.length<3)return!1;var n=e.length,r=e[0].color,i=e.map(function(e){return e.key}),o=i.slice(0).reverse(),u=h["default"].seriesByColor(r);t&&(u=u.slice(0),u.push(u[0]));for(var l=0;l<=u.length-n;l++){var d=u.slice(l,l+n);if(a(d,i)|a(d,o))return!0}return!1}function u(e){var t=e.length,n=e[0].number;return!!(3===t|4===t)&&(!!e.every(function(e){return e.number===n})&&y.some(function(t){return i(t.slice(0,e.length),e)}))}function l(e,t){var n=h["default"].makePiece(t.c,t.n);return n.isFake=!0,h["default"].pieceFake(e)?n:e}function d(e,t){return!e.isFake&&e.key===t.key}function s(e,t){function n(e,t){return e.filter(function(e){return t.indexOf(e)<0})}function r(e,t){return e.key===t.key}function a(e,t){var r=["r","g","b","l"],a=e.filter(function(e){return!d(e,t)}),i=n(r,a.map(function(e){return e.c}));if(i.length<1)return e;if(a.length<1)return e;if(!(a.length<e.length))return e;var o=i[0],u=a[0].n,l=h["default"].makePiece(o,u);return a.push(l),a}function i(e,t){var n;if(0===e.length)return e;if(e.length<3)return e;var a=m(e,3),o=a[0],u=a[1],l=a[2],s=[o,u,l];if(n=e.slice(3,e.length),d(o,t))r(h["default"].pieceUp(u),l)?s=[h["default"].pieceDown(u),u,l]:r(h["default"].pieceDown(u),l)&&(s=[h["default"].pieceUp(u),u,l]);else if(d(u,t))r(h["default"].pieceUp(h["default"].pieceUp(o)),l)?s=[o,h["default"].pieceUp(o),l]:r(h["default"].pieceDown(h["default"].pieceDown(o)),l)&&(s=[o,h["default"].pieceDown(o),l]);else{if(!d(l,t))return n=i(e.slice(1,e.length),t),n.unshift(e[0]),n;r(h["default"].pieceUp(o),u)?s=[o,u,h["default"].pieceUp(u)]:r(h["default"].pieceDown(o),u)&&(s=[o,u,h["default"].pieceDown(u)])}return s.concat(n)}function o(e,t){if(2!=e.length)return e;var n=m(e,2),r=n[0],a=n[1];return d(r,t)?[a,a]:d(a,t)?[r,r]:e}if(e.filter(function(e){return d(e,t)}).length>1)return e;if(e.length<3)return o(e,t);var u=e.filter(function(e){return!d(e,t)});return u.every(function(e){return e.n===u[0].n})?a(e,t):u.every(function(e){return e.c===u[0].c})?i(e,t):e}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=h["default"].pieceUp(t),a=e.map(function(e){return l(e,r)}),i=s(a,r);return o(i,n)|u(i)}function c(e,t){if(2!==e.length)return!1;var n=h["default"].pieceUp(t),r=e.map(function(e){return l(e,n)}),a=s(r,n),i=m(a,2),o=i[0],u=i[1];return o.key===u.key}function p(e,t,n){var r=[],a=h["default"].pieceUp(n);return t=l(t,a),e.series.forEach(function(i,o){var u=i.slice(0),l=i.slice(0);u.splice(0,0,t),l.splice(i.length,0,t),f(u,n)&&r.push(h["default"].getOpenSerieKeyFromGroupIndex(e,o,0)),f(l,n)&&r.push(h["default"].getOpenSerieKeyFromGroupIndex(e,o,i.length+1));var s=i.map(function(e){return d(e,a)?t:e});if(f(s,n)){var c;i.forEach(function(e,t){d(e,a)&&(c=t)}),r.push(h["default"].getOpenSerieKeyFromGroupIndex(e,o,c+1))}}),e.pairs.forEach(function(i,o){var u=i.map(function(e){return d(e,a)?t:e});if(c(u,n)){var l=v(i,a);r.push(h["default"].getOpenPairKeyFromGroupIndex(e,o,l))}}),r}function v(e,t){var n;return e.forEach(function(e,r){d(e,t)&&(n=r)}),n}Object.defineProperty(n,"__esModule",{value:!0});var m=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){a=!0,i=l}finally{try{!r&&u["return"]&&u["return"]()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=e("./pieces"),h=r(g),y=function(){var e=h["default"].colors,t=[];for(var n in e)for(var r in e)for(var a in e)for(var i in e)n!==r&&n!==a&&n!==i&&r!==a&&r!==i&&a!==i&&t.push([e[n],e[r],e[a],e[i]]);return t}();n["default"]={compute:p,series:f,pairs:c,findOkeyIndex:v},t.exports=n["default"]},{"./pieces":14}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=[];for(var n in D)t.push(k(e,n).key);return t}function i(e){var t={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},n=t[e[0]],r=t[e[1]];return void 0===r?void 0===n?{left:e.slice(1)}:{number:n,left:e.slice(1)}:{number:10*n+r,left:e.slice(2)}}function o(e){var t=/([l|r|p])(\d\d?)/,n=e.match(t),r=n[1],a=parseInt(n[2]);return{type:r,groupIndex:a}}function u(e){var t=e[0],n=e[1],r=e[2],a=2;return T[t]?(D[n+r]&&(n+=r,a=3),{piece:k(t,n),left:e.slice(a)}):{left:e.slice(1)}}function l(e){var t=[],n=[];for(e+="\n";e.length>0;){var r=u(e);r.piece?n.push(r.piece):(n.length>0&&t.push(n),n=[]),e=r.left}return t}function d(e){for(var t=[],n=0;e.length>0;){var r=u(e);r.piece&&(t[n]=r.piece),n++,e=r.left}return t}function s(e){var t={};e=d(e);for(var n=0,r=0;r<e.length;r++){if(e[r]){for(;n<100&&!K["default"].isAllowedBoardKey(K["default"].encodeKey(n,"b"));)n++;t[K["default"].encodeKey(n,"b")]=e[r],n++}n++}return t}function f(e,t){e=e.split(" ");var n={};return K["default"].allSides.map(function(e){return K["default"].findPov(t,e)}).forEach(function(t,r){var a=d(e[r]||"");n[K["default"].discardByPov(t)]=a}),n}function c(e){var t=e.split("/"),n=M(t,2),r=n[0],a=n[1];r=l(r),a=l(a);var i=p(r,a);return{series:r,pairs:a,layout:i,relayout:function(e){e.opens.layout=p(e.opens.series,e.opens.pairs)}}}function p(e,t){var n,r,a,i,o,u={},l={series:{},pairs:{}},d=[],s=0;for(n=0;n<e.length;n++){var f=e[n];i=(d[s]||1)-1,o=s,l.series[K["default"].miniPos2key([i,o])]=n;for(var c=0;c<f.length;c++)a=d[s]||1,r=K["default"].miniPos2key([a,s]),u[r]=f[c],d[s]=a+1;d[s]+=2,s++,s>=K["default"].miniRows&&(s=0)}for(d=[],n=0,c=0,r=0,a=0,s=0,n=0;n<t.length;n++){var p=t[n];for(i=(d[s]||K["default"].miniColumns-1)-1,o=s,l.pairs[K["default"].miniPos2key([i,o])]=n,c=p.length-1;c>=0;c--)a=d[s]||K["default"].miniColumns-1,r=K["default"].miniPos2key([a,s]),u[r]=p[c],d[s]=a-1;d[s]-=1,s++,s>=K["default"].miniRows&&(s=0)}return{layout:u,groupMap:l}}function v(e,t,n){for(var r in e)if(e[r]===t){var a=K["default"].miniKey2pos(r),i=M(a,2),o=i[0],u=i[1],l=[o+n,u];return K["default"].miniPos2key(l)}}function m(e,t,n){var r=e.layout.groupMap.pairs;return v(r,t,n)}function g(e,t,n){var r=e.layout.groupMap.series;return v(r,t,n)}function h(e,t){var n=e.opens,r=n.series,a=n.layout.groupMap,i=M(t,2),o=i[0],u=i[1];for(var l in a.series){var d=a.series[l],s=r[d],f=K["default"].miniKey2pos(l),c=M(f,2),p=c[0],v=c[1],m=o-p;if(!(m<0||m>s.length+1||u!=v))return[d,m]}}function y(e,t){var n=e.opens,r=n.pairs,a=n.layout.groupMap,i=M(t,2),o=i[0],u=i[1];for(var l in a.pairs){var d=a.pairs[l],s=(r[d],K["default"].miniKey2pos(l)),f=M(s,2),c=f[0],p=f[1],v=o-c;if(!(v<0||v>1||u!=p))return[d,v]}}function w(e){var t={},n=i(e);return t[K["default"].middleCount]=n.number,n=u(n.left),t[K["default"].gosterge]=n.piece,t}function b(e){e=e.split("/");var t=2,n=3,r=4,a=1,i=0,o={e:"east",w:"west",n:"north",s:"south"}[e[i]];return{pieces:s(e[t]),discards:f(e[n],o),opens:c([e[r],e[r+1]].join("/")),middles:w(e[a])}}function P(e){var t=K["default"].allKeys.map(function(t){return e[t]}).map(function(e){return e&&e.key||" "}).join("");return t.replace(/([^\s])\s/g,"$1")}function k(e,t){return{color:T[e],number:D[t],c:e,n:parseInt(t),key:e+t}}function O(e){var t=e.c,n=e.n%13+1;return k(t,n)}function x(e){var t=e.c,n=(e.n+11)%13+1;return k(t,n)}function S(e){return"fake"===e.color}function E(e){return e.length>0&&14===e.match(A).length}var M=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){a=!0,i=l}finally{try{!r&&u["return"]&&u["return"]()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),C=e("./util"),K=r(C),T={b:"blue",r:"red",g:"green",l:"black",f:"fake"},D={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine",10:"ten",11:"eleven",12:"twelve",13:"thirteen"},A=/[f|r|l|b|g]\d\d?/g,B=function(){var e={};for(var t in T)e[T[t]]=a(t);return e}(),j=function(e){return B[e]},R="g7r7b7l7 g8r8b8l8 g13r13b13l13 l12 r6r5r4r12r13 g9g8g13 g6 l8l7l12",G="r1g1l1b1 r2g2l2b2 r3g3l3b3 r4g4l4b4 r13g13l13b13 r1g1l1b1",L="r1r2 r3r4r5r6r7r8r9r10r11r12r13l1l2l3l4l5l6l7   g1g2  l3",F="20l3",N="b1  r1r2 g1",_="r8l8b8\nb1b2b3\nb9b10b11b12\nl13r13b13\nr12b12g12\nr7r8r9r10\ng10g11g12\nl6b6r6\nl9l10l11\nb7l7r7g7\nr13l13b13g13\nl10r10b10g10\nl6r6g6\nl1b1g1\n/r1r1\ng1g1\ng2g2\ng3g3\ng4g4\ng5g5\ng6g6\ng7g7\ng8g8\ng9g9\ng10g10\ng11g11\ng12g12\n\n";t.exports={validDuzOkeyGroupFen:E,initial:L,rainbow:G,mixed:R,write:P,read:b,readDropPos:o,readPiece:u,readBoard:s,initialMiddles:F,initialDiscards:N,initialOpenGroups:_,readMiddles:w,readDiscards:f,readPieceGroup:l,readOpenGroups:c,layoutOpens:p,seriesByColor:j,makePiece:k,pieceUp:O,pieceDown:x,pieceFake:S,colors:T,getOpenSerieKeyFromGroupIndex:g,getOpenPairKeyFromGroupIndex:m,getOpenSerieFromPos:h,getOpenPairFromPos:y}},{"./util":16}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.piece,a=n.group,p=n.pos,v=B["default"].findPov(e.povSide,e.turnSide);if(e.turnSide!==e.povSide||e.spectator)switch(t){case R["default"].drawMiddle:s(e),e.animation.current.hint=R["default"].drawMiddle;break;case R["default"].drawLeft:f(e,B["default"].drawByPov(v)),e.animation.current.hint=R["default"].drawLeft;break;case R["default"].discard:r=L["default"].readPiece(r).piece,d(e,B["default"].discardByPov(v),r),e.animation.current.hint=R["default"].discard;break;case R["default"].leaveTaken:r=L["default"].readPiece(r).piece,c(e,B["default"].drawByPov(v),r),e.animation.current.hint=R["default"].leaveTaken;break;case R["default"].openSeries:a=L["default"].readPieceGroup(a),u(e,a),e.animation.current.hint=R["default"].openSeries;break;case R["default"].openPairs:a=L["default"].readPieceGroup(a),l(e,a),e.animation.current.hint=R["default"].openSeries;break;case R["default"].dropOpenSeries:r=L["default"].readPiece(r).piece,p=L["default"].readDropPos(p),i(e,r,p);break;case R["default"].dropOpenPairs:r=L["default"].readPiece(r).piece,p=L["default"].readDropPos(p),o(e,r,p);break;default:console.error("unknown move")}else if(e.spectator)t===R["default"].leaveTaken&&(r=L["default"].readPiece(r).piece,c(e,B["default"].drawByPov(v),r),e.animation.current.hint=R["default"].leaveTaken);else switch(t){case R["default"].discard:r=L["default"].readPiece(r).piece,m(e,r,B["default"].discards[2]),e.animation.current.hint=R["default"].discard;break;case R["default"].drawMiddle:r=L["default"].readPiece(r).piece,e.middleHolder.current?I["default"].apiDrawMiddleEnd(e,r):I["default"].apiForceDrawMiddleEnd(e,r),e.animation.current.hint=R["default"].drawMiddle;break;case R["default"].leaveTaken:I["default"].playLeaveTaken(e,r)}}function i(e,t,n){var r=n.type,a=n.groupIndex,i=e.opens.series[a],o=r!==R["default"].dropReplace?0:1,u=0;if(r===R["default"].dropLeft)u=0;else if(r===R["default"].dropRight)u=i.length+1;else{var l=L["default"].pieceUp(e.middles[B["default"].gosterge]);u=N["default"].findOkeyIndex(i,l)+1}i.splice(u-o,o,t),e.opens.relayout(e)}function o(e,t,n){var r=n.groupIndex,a=e.opens.pairs[r],i=L["default"].pieceUp(e.middles[B["default"].gosterge]),o=N["default"].findOkeyIndex(a,i);a.splice(o,1,t),e.opens.relayout(e)}function u(e,t){var n=t,r=e.opens.series.concat(n);e.opens.series=r,e.opens.relayout(e)}function l(e,t){var n=t,r=e.opens.pairs.concat(n);e.opens.pairs=r,e.opens.relayout(e)}function d(e,t,n){return e.discards[t].unshift(n),e.lastMove=[t],!0}function s(e){return e.middles[B["default"].middleCount]--,e.lastMove=[B["default"].middleCount],!0}function f(e,t){return e.discards[t].shift(),!0}function c(e,t,n){return e.discards[t].unshift(n),!0}function p(e,t,n,r){if(!e.pieces[t]||!r)return!1;var a=e.pieces[t];X(B["default"].partial(e.events.move,R["default"].dropOpenSeries,U(a.key)));var i=D(r,2),o=i[0],u=i[1],l=e.opens.series[o],d=w(l,u),s=d!==R["default"].dropReplace?0:1;if(l.splice(u-s,s,a),e.opens.relayout(e),delete e.pieces[t],d===R["default"].dropReplace){var f=L["default"].pieceUp(e.middles[B["default"].gosterge]);e.pieces[t]=f}return!0}function v(e,t,n,r){if(!e.pieces[t]||!r)return!1;var a=e.pieces[t];X(B["default"].partial(e.events.move,R["default"].dropOpenPairs,U(a.key)));var i=D(r,2),o=i[0],u=i[1],l=e.opens.pairs[o];l.splice(u,1,a),e.opens.relayout(e),delete e.pieces[t];var d=L["default"].pieceUp(e.middles[B["default"].gosterge]);return e.pieces[t]=d,!0}function m(e,t,n){for(var r in e.pieces){var a=e.pieces[r];if(a&&B["default"].pieceEqual(t,a))return g(e,r,n),!0}return!1}function g(e,t,n){var r=e.pieces[t];return!!r&&(X(B["default"].partial(e.events.move,R["default"].discard,U(r.key))),e.discards[n].unshift(e.pieces[t]),delete e.pieces[t],e.lastMove=[n],!0)}function h(e,t){var n=e.pieces[t];return!!n&&(!!B["default"].pieceEqual(n,e.middles[B["default"].gosterge])&&(X(B["default"].partial(e.events.move,R["default"].sign,U(n.key))),!0))}function y(e,t){var n=e.pieces[t];if(!n)return!1;delete e.pieces[t];var r=(L["default"].write(e.pieces),I["default"].getPieceGroupSeries(e)),a=I["default"].getPieceGroupPairs(e);if(L["default"].validDuzOkeyGroupFen(r))X(B["default"].partial(e.events.move,R["default"].discardEndSeries,q(r)));else{if(!L["default"].validDuzOkeyGroupFen(a))return e.pieces[t]=n,!1;X(B["default"].partial(e.events.move,R["default"].discardEndPairs,q(a)))}return!0}function w(e,t){return 0===t?R["default"].dropLeft:t===e.length+1?R["default"].dropRight:R["default"].dropReplace}function b(e,t,n){if(n&&B["default"].isOpensKey(n)&&E(e,t,n)){var r,a,i,o,u,l=e.pieces[t],d=L["default"].getOpenSerieFromPos(e,B["default"].miniKey2pos(n));if(d){var s=D(d,2);r=s[0],a=s[1],i=e.opens.series[r],o=w(i,a),u=o+r}if(p(e,t,n,d))return X(B["default"].partial(e.movable.events.after,R["default"].dropOpenSeries,H(l.key,u))),!0;var f=L["default"].getOpenPairFromPos(e,B["default"].miniKey2pos(n));if(f){var c=D(f,2);r=c[0],a=c[1],i=e.opens.pairs[r],o=w(i,a),u=o+r}if(v(e,t,n,f))return X(B["default"].partial(e.movable.events.after,R["default"].dropOpenPairs,H(l.key,u))),!0}return!1}function P(e,t,n){var r=e.pieces[t];if(n&&n===B["default"].discards[2]){if(M(e,t,n)&&g(e,t,n))return X(B["default"].partial(e.movable.events.after,R["default"].discard,U(r.key))),!0}else if(n===B["default"].gosterge){if(K(e,t)&&h(e,t))return X(B["default"].partial(e.movable.events.after,R["default"].sign,U(r.key))),!0;if(C(e,t)&&y(e,t)){var a=(L["default"].write(e.pieces),I["default"].getPieceGroupSeries(e)),i=I["default"].getPieceGroupPairs(e);return L["default"].validDuzOkeyGroupFen(a)?X(B["default"].partial(e.movable.events.after,R["default"].discardEndSeries,q(a))):L["default"].validDuzOkeyGroupFen(i)&&X(B["default"].partial(e.movable.events.after,R["default"].discardEndPairs,q(i))),!0}}return!1}function k(e,t){O(e,t)}function O(e,t){e.selected=t}function x(e,t){return B["default"].isMiddleKey(t)||B["default"].isDrawLeftKey(t)?e.povSide===e.turnSide:B["default"].isBoardKey(t)}function S(e){return e.povSide===e.turnSide}function E(e,t,n){var r=e.middles[B["default"].gosterge];return I["default"].isDroppableOpens(e,t)&&B["default"].isBoardKey(t)&&B["default"].isOpensKey(n)&&B["default"].containsX(e.movable.dests,R["default"].dropOpenSeries)&&B["default"].containsX(e.movable.dests,R["default"].dropOpenPairs)&&B["default"].containsX(N["default"].compute(e.opens,e.pieces[t],r),n)}function M(e,t,n){return S(e)&&B["default"].containsX(e.movable.dests,R["default"].discard)}function C(e,t){return S(e)&&B["default"].containsX(e.movable.dests,R["default"].discardEndSeries)}function K(e,t){return S(e)&&B["default"].containsX(e.movable.dests,R["default"].showSign)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B["default"].topColumns,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B["default"].topRows;return function(r,a,i){if(i||r.bounds){i=i||r.bounds();var o=Math.floor(t*((a[0]-i.left)/i.width)),u=Math.floor(n*((a[1]-i.top)/i.height));return u>=0&&u<n&&o>=0&&o<t?e(u,o):void 0}}}Object.defineProperty(n,"__esModule",{value:!0});var D=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){a=!0,i=l}finally{try{!r&&u["return"]&&u["return"]()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),A=e("./util"),B=r(A),j=e("./move"),R=r(j),G=e("./pieces"),L=r(G),F=e("./open"),N=r(F),_=e("./board"),I=r(_),H=B["default"].wrapDrop,U=B["default"].wrapPiece,q=B["default"].wrapGroup,X=B["default"].callUserFunction,z=T(function(e,t){return B["default"].miniPos2key([t,e])},B["default"].miniColumns,B["default"].miniRows),$=T(function(e,t){if(e===B["default"].topRows-1){if(0===t)return B["default"].discards[1];if(t===B["default"].topColumns-4)return B["default"].middleCount}}),J=T(function(e,t){if(e===B["default"].topRows-1){if(t===B["default"].topColumns-1)return B["default"].discards[2];if(t===B["default"].topColumns-3)return B["default"].gosterge}});n["default"]={apiMove:a,selectTop:k,dropTop:P,dropOpens:b,isDraggable:x,getDrawKeyAtDomPos:$,getDiscardKeyAtDomPos:J,getOpensKeyAtDomPos:z},t.exports=n["default"]},{"./board":5,"./move":12,"./open":13,"./pieces":14,"./util":16}],16:[function(e,t,n){"use strict";function r(e,t){return _[e][t]}function a(e,t){return e.color===t.color&&e.number===t.number}function i(e,t){for(var n=[],r=0;r<e;r++)for(var a=0;a<t;a++)n.push([a,r]);return n}function o(e,t){return t+e}function u(e,t){return parseInt(e.slice(1))}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return o(u(e)-t,W)}function d(e){return e[0]===W}function s(e){return e[0]===Z}function f(e){return e===J}function c(e){return e===$[1]}function p(e){var t=e[1]*B+e[0];return o(t,W)}function v(e){return e=u(e),[e%B,Math.floor(e/B)]}function m(e){return o(e,W)}function g(e,t){function n(e){var t=Math.floor(e/B),n=e%B;return[n,t]}function r(e){return e[1]*B+e[0]}var a=n(e),i=n(e+2*t);return a[1]!==i[1]?r([1,1]):(1===a[1]&&0===a[0]&&(a[0]=1),r(a))}function h(e){return Y[e]}function y(e){var t=e[1]*L+e[0];return o(t,Z)}function w(e){return e=u(e),[e%L,Math.floor(e/L)]}function b(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function P(e,t){return e&&e.indexOf(t)!==-1}function k(e){return e.touches?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[e.clientX,e.clientY]}function O(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function x(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function S(){return A||(A=x()),A}function E(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function M(e,t){return e.bind.apply(e,[null].concat(t))}function C(){return M(arguments[0],Array.prototype.slice.call(arguments,1))}function K(e){return 2===e.buttons||2===e.button}function T(e){var t,n=function(){return void 0===t&&(t=e()),t};return n.clear=function(){
t=void 0},n}function D(e){setTimeout(e,1)}var A,B=32,j=2,R=16,G=7,L=20,F=8,N=["east","west","north","south"],_={east:{east:"down",west:"up",north:"right",south:"left"},west:{east:"up",west:"down",north:"left",south:"right"},north:{east:"left",west:"right",north:"down",south:"up"},south:{east:"right",west:"left",north:"up",south:"down"}},I={up:0,left:1,down:2,right:3},H={up:3,left:0,down:1,right:2},U={up:[.5,0],left:[0,.5],right:[1,.5],down:[.5,1]},q=function(e){return U[e]},X=function(e){return $[I[e]]},z=function(e){return $[H[e]]},$=["dup","dleft","ddown","dright"],J="mmiddleCount",V="mgosterge",Y={dup:[0,0],dleft:[0,G-1],ddown:[R-1,G-1],dright:[R-1,0],mmiddleCount:[R-4,G-1],mgosterge:[R-3,G-1]},Q={color:"empty",number:1},W="b",Z="o",ee=i(j,B),te=i(F,L),ne=[[0,0],[30,0],[31,0],[32,0],[62,0],[63,0]].map(p),re=function(e){return ne.indexOf(e)===-1},ae=ee.map(p),ie=ae.filter(re),oe=function(e){return ie.indexOf(e)!==-1},ue=te.map(y),le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.piece=e,t},de=function(e){return{group:e}},se=function(e,t){return{piece:e,pos:t}};t.exports={topColumns:R,topRows:G,columns:B,rows:j,emptyPiece:Q,pieceEqual:a,allSides:N,allPos:ee,allKeys:ae,topKey2pos:h,pos2key:p,key2pos:v,iterator2Key:m,nextIteratorForGroup:g,miniColumns:L,miniRows:F,miniAllPos:te,miniAllKeys:ue,miniPos2key:y,miniKey2pos:w,encodeKey:o,decBoardKey:l,notAllowedBoardKeys:ne,isAllowedBoardKey:re,isAllAllowedBoardKey:oe,allAllowedBoardKeys:ie,isBoardKey:d,isOpensKey:s,isMiddleKey:f,isDrawLeftKey:c,findPov:r,vectorByPov:q,drawByPov:z,discardByPov:X,discards:$,middleCount:J,gosterge:V,classSet:b,containsX:P,eventPosition:k,distance:O,transformProp:S,translate:E,requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),partialApply:M,partial:C,isRightButton:K,memo:T,wrapPiece:le,wrapGroup:de,wrapDrop:se,callUserFunction:D}},{}],17:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){return e.color+" "+e.number}function i(e){return{left:e[0]*(100/j["default"].columns)+"%",top:e[1]*(100/j["default"].rows)+"%"}}function o(e){return{left:e[0]*(100/j["default"].miniColumns)+"%",top:e[1]*(100/j["default"].miniRows)+"%"}}function u(e,t,n,r){var i=(e.data,{key:n,style:o(t),"class":a(r)+" mini"});if(e.data.animation.current.anims){var u=e.data.animation.current.anims[n],l=e.data.animation.current.scales[n];u&&(i["class"]+=" animating",i.style[j["default"].transformProp()]=j["default"].translate(u[1]),l&&(i.style[j["default"].transformProp()]+=" scale("+l[0]+", "+l[1]+")",i.style.transformOrigin="center"))}return{tag:"piece",attrs:i}}function l(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.data,o=j["default"].classSet({selected:i.selected===t,"last-move":i.lastMove&&j["default"].containsX(i.lastMove,t)}),u={style:{},"class":[a(n),t,o].join(" "),"data-middle-count":e.data.middles[t]},l=e.data.draggable.current;if(r&&l.orig===t)u.style[j["default"].transformProp()]=j["default"].translate([l.pos[0]+l.dec[0],l.pos[1]+l.dec[1]]),u["class"]+=" dragging";else if(!r&&e.data.animation.current.anims){var d=e.data.animation.current.anims[t];d&&(u["class"]+=" animating",u.style[j["default"].transformProp()]=j["default"].translate(d[1]))}return{tag:"piece",attrs:u}}function d(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t,u=e.data,l=j["default"].classSet({selected:u.selected===t}),d={style:{},"class":[a(n),t,l].join(" ")};r&&(d["class"]+=" "+r);var s=e.data.draggable.current;if(i&&s.orig===t)d.style[j["default"].transformProp()]=j["default"].translate([s.pos[0]+s.dec[0],s.pos[1]+s.dec[1]]),d["class"]+=" dragging";else if(i&&e.data.animation.current.anims){var f=e.data.animation.current.anims[o];f&&(d["class"]+=" animating",d.style[j["default"].transformProp()]=j["default"].translate(f[1]))}return{tag:"piece",attrs:d}}function s(e,t,n){var r=(e.data,j["default"].classSet({"piece-holder":!0})),a={style:{},"class":[t,r,n].join(" ")};return{tag:"div",attrs:a}}function f(e,t,n,r){var a="flipper"+(n?" hover":"")+" "+r,i={top:0,left:0},o=e.attrs.style;e.attrs.style=i,t.attrs.style=i;var u={"class":a,style:o};return{tag:"div",attrs:u,children:[{tag:"div",attrs:{"class":"front"},children:[e]},{tag:"div",attrs:{"class":"back"},children:[t]}]}}function c(e,t,n,r,o){var u=e.data,l=j["default"].classSet({selected:u.selected===n}),d={key:n,style:i(t),"class":[a(r),l].join(" ")};o&&(d["class"]+=" "+o);var s=e.data.draggable.current;if(s.dragGroup&&s.dragGroup.indexOf(n)!==-1?(d.style[j["default"].transformProp()]=j["default"].translate([s.pos[0]+s.dec[0],s.pos[1]+s.dec[1]]),d["class"]+=" group dragging"):s.orig===n&&(s.over&&j["default"].isOpensKey(s.over)&&(d.style.width=s.opensBounds.width/j["default"].miniColumns+"px",d.style.height=s.opensBounds.height/j["default"].miniRows+"px"),d.style[j["default"].transformProp()]=j["default"].translate([s.pos[0]+s.dec[0],s.pos[1]+s.dec[1]]),d["class"]+=" dragging"),e.data.animation.current.anims){var f=e.data.animation.current.anims[n];f&&(d["class"]+=" animating",d.style[j["default"].transformProp()]=j["default"].translate(f[1]))}return{tag:"piece",attrs:d}}function p(e,t,n){return{tag:"div",attrs:{"class":e+" oc "+n}}}function v(e,t,n){return{tag:"div",attrs:{style:o(n),"class":e+" oc"}}}function m(e,t,n){return{tag:"div",attrs:{style:i(n),"class":e}}}function g(e){function t(e){return{tag:"div",attrs:{"class":"wood "+e}}}var n,r=e.data,a=j["default"].allPos,i=[];i.push(t("left"),t("right"));for(var o=0;o<a.length;o++){var u=j["default"].pos2key(a[o]),l=r.pieces[u];if(l){var d=c(e,a[o],u,l);if(r.flippable.current.orig===u){var s,p,v=r.flippable.current.flip,g=c(e,a[o],u,j["default"].emptyPiece);l.flip?(s=g,p=d):(s=d,p=g),i.push(f(s,p,v))}else l.flip&&(d=c(e,a[o],u,j["default"].emptyPiece)),i.push(d)}r.draggable.current.over===u&&(n=m("drag-over",e,a[o]))}return r.middleHolder.key&&i.push(c(e,j["default"].key2pos(r.middleHolder.key),r.middleHolder.key,j["default"].emptyPiece,"loading")),n&&i.push(n),{tag:"div",attrs:{config:function(t,n,r){n||(e.data.boardBounds=j["default"].memo(t.getBoundingClientRect.bind(t)))},"class":"og-board"},children:i}}function h(e,t){for(var n=e.data,r=j["default"].miniAllPos,a=[],i=[],o=0;o<r.length;o++){var l=j["default"].miniPos2key(r[o]),d=t[l];if(d&&a.push(u(e,r[o],l,d)),e.data.animation.current.anims){var s=e.data.animation.current.anims[l];d=e.data.animation.current.extra[l],s&&d&&a.push(u(e,r[o],l,d))}var f=j["default"].classSet({"drag-over":n.draggable.current.over===l,"move-dest":j["default"].containsX(n.openable.dests,l)});""!==f&&i.push(v(f,e,r[o]))}return a.push(i),a}function y(e){var t=e.data,n=h(e,t.opens.layout.layout);return{tag:"div",attrs:{config:function(t,n,r){n||(e.data.opensBounds=j["default"].memo(t.getBoundingClientRect.bind(t)))},"class":"og-opens"},children:n}}function w(e){var t=e.data,n=[],r=[];for(var a in t.discards){var i=t.discards[a][0],o=j["default"].classSet({"drag-over":t.draggable.current.over===a,"move-dest":"ddown"===a&&t.selected&&j["default"].isBoardKey(t.selected)&&j["default"].containsX(t.movable.dests,G["default"].discard),"last-move":t.lastMove&&j["default"].containsX(t.lastMove,a)});if(i){t.discards[a][1]&&r.push(d(e,a,t.discards[a][1],"fake",!1)),r.push(d(e,a,i,o));var u=G["default"].drawLeft+a,l=!!e.data.animation.current.anims&&e.data.animation.current.anims[u];if(l){var f=e.data.animation.current.extra.piece;r.push(d(e,a,f,o,!0,u))}}else n.push(s(e,a,o))}return n.push(r),n}function b(e){var t=e.data,n=[],r=t.middleHolder.piece||j["default"].emptyPiece;if(n.push(d(e,j["default"].gosterge,t.middles[j["default"].gosterge])),n.push(l(e,j["default"].middleCount,j["default"].emptyPiece)),j["default"].isMiddleKey(t.draggable.current.orig)||t.animation.current.anims&&t.animation.current.anims[j["default"].middleCount]){var a=l(e,j["default"].middleCount,r,!0);n.push(a)}return t.draggable.current.over===j["default"].gosterge&&n.push(p("drag-over",e,j["default"].gosterge)),n}function P(e){var t=[],n=e.data.topHooks;return n&&t.push(n),t}function k(e){var t=[b(e),w(e),y(e),P(e)];return{tag:"div",attrs:{config:function(t,n,r){n||(e.data.topBounds=j["default"].memo(t.getBoundingClientRect.bind(t)))},"class":"og-top"},children:t}}function O(e){return[k(e),g(e)]}function x(e,t,n){return function(r){j["default"].isRightButton(r)?n(e,r):e.viewOnly||t(e,r)}}function S(e,t,n){var r=e.data,a=x(r,T["default"].start,A["default"].start),i=x(r,T["default"].move,A["default"].move),o=x(r,T["default"].end,A["default"].end),u=["touchstart","mousedown"],l=["touchmove","mousemove"],d=["touchend","mouseup"];u.forEach(function(e){t.addEventListener(e,a)}),l.forEach(function(e){document.addEventListener(e,i)}),d.forEach(function(e){document.addEventListener(e,o)}),n.onunload=function(){u.forEach(function(e){t.removeEventListener(e,a)}),l.forEach(function(e){document.removeEventListener(e,i)}),d.forEach(function(e){document.removeEventListener(e,o)})}}function E(e){return{tag:"div",attrs:{"class":"og-table",config:function(t,n,r){n||(e.data.viewOnly||S(e,t,r),e.data.render=function(){C["default"].render(t,O(e))},e.data.renderRAF=function(){j["default"].requestAnimationFrame(e.data.render)},e.data.bounds=j["default"].memo(t.getBoundingClientRect.bind(t)),e.data.element=t,e.data.render())}},children:[]}}var M=e("mithril"),C=r(M),K=e("./drag"),T=r(K),D=e("./draw"),A=r(D),B=e("./util"),j=r(B),R=e("./move"),G=r(R);t.exports=function(e){return{tag:"div",attrs:{config:function(t,n){n||(t.addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),["onscroll","onresize"].forEach(function(t){var n=window[t];window[t]=function(){n&&n(),e.data.bounds.clear(),e.data.boardBounds.clear(),e.data.opensBounds.clear(),e.data.topBounds.clear()}}))},"class":["og-table-wrap"].join(" ")},children:[E(e)]}}},{"./drag":9,"./draw":10,"./move":12,"./util":16,mithril:2}]},{},[11])(11)});